generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserTable {
  id              String           @id @default(uuid()) @db.Uuid
  authUserId      String           @unique
  userName        String?
  email           String?          @unique
  phoneNo         BigInt?          @unique
  resumeUrl       String?
  bio             String?
  profilePicture  String?
  templatesUsed   Int              @default(0)
  profileDataId   Int?             @unique
  createdAt       DateTime         @default(now())
  firstName       String?
  lastName        String?
  jobsAdded       JobPool[]
  messages        ReferralMsg[]
  Thread          Thread[]
  userProfileData UserProfileData?
}

model UserProfileData {
  id               Int                  @id @default(autoincrement())
  summary          String?
  education        Json?
  userId           String               @unique
  experiences      Experience[]
  profileSkills    ProfilSkillMapping[]
  profileReadiness ProfileReadiness?
  User             UserTable            @relation(fields: [userId], references: [authUserId])
}

model ProfilSkillMapping {
  id                Int             @id @default(autoincrement())
  userProfileDataId Int
  skillId           Int
  Skills            Skills          @relation(fields: [skillId], references: [id])
  UserProfileData   UserProfileData @relation(fields: [userProfileDataId], references: [id])

  @@unique([userProfileDataId, skillId])
}

model Skills {
  id                 Int                  @id @default(autoincrement())
  name               String               @unique
  category           String
  ProfilSkillMapping ProfilSkillMapping[]
}

model Experience {
  id                Int             @id @default(autoincrement())
  companyName       String
  role              String
  startDate         DateTime?
  endDate           DateTime?
  description       String?
  userProfileDataId Int
  UserProfileData   UserProfileData @relation(fields: [userProfileDataId], references: [id])
}

model ReferralMsg {
  id         Int           @id @default(autoincrement())
  message    String
  subject    String?
  userId     String
  employeeId Int
  jobId      Int?
  date       DateTime      @default(now())
  threadId   Int
  followUps  FollowUpMsg[]
  Employee   EmpInfo       @relation(fields: [employeeId], references: [id])
  Job        JobPool?      @relation(fields: [jobId], references: [id])
  Thread     Thread        @relation(fields: [threadId], references: [id])
  User       UserTable     @relation(fields: [userId], references: [authUserId])
}

model FollowUpMsg {
  id          Int         @id @default(autoincrement())
  message     String
  referralId  Int
  version     Int         @default(1)
  sentAt      DateTime    @default(now())
  threadId    Int
  ReferralMsg ReferralMsg @relation(fields: [referralId], references: [id])
  Thread      Thread      @relation(fields: [threadId], references: [id])
}

model EmpInfo {
  id          Int           @id @default(autoincrement())
  name        String
  email       String?
  phoneNo     BigInt?
  linkedInUrl String?
  companyName String
  createdAt   DateTime      @default(now())
  referrals   ReferralMsg[]
}

model JobPool {
  id          Int           @id @default(autoincrement())
  niche       String
  title       String?
  jobUrl      String?
  jobId       String?
  companyName String?
  addedById   String?       @db.Uuid
  createdAt   DateTime      @default(now())
  addedBy     UserTable?    @relation(fields: [addedById], references: [id])
  referrals   ReferralMsg[]
}

model ProfileReadiness {
  id                 Int                       @id @default(autoincrement())
  userProfileId      Int                       @unique
  completenessStatus ProfileCompletenessStatus @default(INCOMPLETE)
  lastUpdated        DateTime                  @default(now())
  UserProfileData    UserProfileData           @relation(fields: [userProfileId], references: [id])
}

model Thread {
  id          Int           @id @default(autoincrement())
  type        EmailType
  threadId    String
  createdAt   DateTime      @default(now())
  status      ThreadStatus  @default(PENDING)
  userId      String
  FollowUpMsg FollowUpMsg[]
  ReferralMsg ReferralMsg[]
  UserTable   UserTable     @relation(fields: [userId], references: [authUserId])
}

enum RefStatus {
  FOLLOWUP
  CLOSED
  PENDING
}

enum ProfileCompletenessStatus {
  INCOMPLETE
  PARTIAL
  COMPLETE
}

enum EmailType {
  USER
  REPLY
}

enum ThreadStatus {
  PENDING
  FOLLOWUP
  CLOSED
}
