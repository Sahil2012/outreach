generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserProfileData {
  id            Int                       @id @default(autoincrement())
  summary       String?
  education     Json?
  authUserId    String                    @unique
  email         String?                   @unique
  firstName     String?
  lastName      String?
  phoneNo       BigInt?                   @unique
  resumeUrl     String?
  status        ProfileCompletenessStatus @default(INCOMPLETE)
  credits       Int                       @default(5)
  experiences   Experience[]
  Message       Message[]
  profileSkills ProfilSkillMapping[]
  Thread        Thread[]
}

model ProfilSkillMapping {
  id                Int             @id @default(autoincrement())
  userProfileDataId Int
  skillId           Int
  Skills            Skills          @relation(fields: [skillId], references: [id])
  UserProfileData   UserProfileData @relation(fields: [userProfileDataId], references: [id])

  @@unique([userProfileDataId, skillId])
}

model Skills {
  id                 Int                  @id @default(autoincrement())
  name               String               @unique
  category           String
  ProfilSkillMapping ProfilSkillMapping[]
}

model Experience {
  id                Int             @id @default(autoincrement())
  companyName       String
  role              String
  startDate         DateTime?
  endDate           DateTime?
  description       String?
  userProfileDataId Int
  UserProfileData   UserProfileData @relation(fields: [userProfileDataId], references: [id])
}

model Thread {
  id               Int                @id @default(autoincrement())
  authUserId       String
  employeeId       Int
  type             EmailType
  createdAt        DateTime           @default(now())
  lastUpdated      DateTime
  status           ThreadStatus       @default(PENDING)
  automated        Boolean            @default(false)
  externalThreadId String?
  Message          Message[]
  UserTable        UserProfileData    @relation(fields: [authUserId], references: [authUserId])
  Employee         Employee           @relation(fields: [employeeId], references: [id])
  ThreadJobMapping ThreadJobMapping[]
}

model Employee {
  id       Int      @id @default(autoincrement())
  name     String
  email    String?  @unique
  position String?
  company  String?
  Thread   Thread[]
}

model Job {
  id               Int                @id @default(autoincrement())
  title            String?
  company          String?
  location         String?
  description      String?
  jobId            String             @unique
  link             String?
  niche            String?
  ThreadJobMapping ThreadJobMapping[]
}

model Message {
  id                Int             @id @default(autoincrement())
  body              String
  subject           String?
  authUserId        String
  threadId          Int?
  date              DateTime        @default(now())
  fromUser          Boolean
  externalMessageId String?
  state             MessageState    @default(DRAFT)
  UserTable         UserProfileData @relation(fields: [authUserId], references: [authUserId])
  Thread            Thread?         @relation(fields: [threadId], references: [id])
}

model ThreadJobMapping {
  id       Int    @id @default(autoincrement())
  threadId Int
  jobId    Int
  Job      Job    @relation(fields: [jobId], references: [id])
  Thread   Thread @relation(fields: [threadId], references: [id])

  @@unique([threadId, jobId])
}

enum RefStatus {
  FOLLOWUP
  CLOSED
  PENDING
}

enum ProfileCompletenessStatus {
  INCOMPLETE
  PARTIAL
  COMPLETE
}

enum EmailType {
  TAILORED
  COLD
}

enum ThreadStatus {
  PENDING
  FIRST_FOLLOW_UP
  SECOND_FOLLOW_UP
  THIRD_FOLLOW_UP
  CLOSED
  REFFERED
  SENT
  DELETED
}

enum MessageState {
  SENT
  DRAFT
}
